import{j as e,u as E,o as N}from"./index-Dh-0Cy2I.js";import{r as d,e as R}from"./react-vendor-Byl6S4M9.js";import{u as _,P as I,E as F,l as $,a as z,C as q}from"./stripe-vendor-MUlDB4Bh.js";import{b as A,c as w}from"./analytics-o4OqUApf.js";import"./auth-vendor-Cg5HAGal.js";function M({totalAmount:m,onPaymentSuccess:u}){const x=_(),[a,r]=d.useState(null),[v,g]=d.useState(!1);return d.useEffect(()=>{if(!x)return;const o=x.paymentRequest({country:"US",currency:"usd",total:{label:"Total",amount:Math.round(m*100)},requestPayerName:!0,requestPayerEmail:!0,requestPayerPhone:!0,requestShipping:!0,shippingOptions:[{id:"free-shipping",label:"Free Shipping",detail:"Arrives in 5-7 business days",amount:0}]});return o.canMakePayment().then(l=>{console.log("[Payment Request] Can make payment:",l),l?(r(o),g(!0),console.log("[Payment Request] Apple Pay/Google Pay available!")):console.log("[Payment Request] No digital wallets available")}).catch(l=>{console.error("[Payment Request] Error checking payment availability:",l)}),o.on("paymentmethod",async l=>{try{await u(l.paymentMethod.id),l.complete("success")}catch(h){console.error("Payment failed:",h),l.complete("fail")}}),()=>{o.off("paymentmethod")}},[x,m,u]),d.useEffect(()=>{a&&a.update({total:{label:"Total",amount:Math.round(m*100)}})},[m,a]),!v||!a?null:e.jsxs("div",{className:"mb-6",children:[e.jsx(I,{options:{paymentRequest:a,style:{paymentRequestButton:{type:"default",theme:"dark",height:"48px"}}}}),e.jsxs("div",{className:"relative my-6",children:[e.jsx("div",{className:"absolute inset-0 flex items-center",children:e.jsx("div",{className:"w-full border-t border-gray-300"})}),e.jsx("div",{className:"relative flex justify-center text-sm",children:e.jsx("span",{className:"px-4 bg-white text-gray-500",children:"Or pay with card"})})]})]})}const T=$("pk_test_your_stripe_publishable_key");function B(){const m=R(),u=_(),x=z(),{items:a,getTotalPrice:r,clearCart:v}=E(),[g,o]=d.useState(!1),[l,h]=d.useState(null);d.useEffect(()=>{a.length>0&&A(r(),a)},[]);const[n,P]=d.useState({email:"",name:"",phone:""}),[s,y]=d.useState({line1:"",line2:"",city:"",state:"",postal_code:"",country:"US"}),k=async t=>{if(!u)throw new Error("Stripe not initialized");if(!n.email||!n.name||!s.line1||!s.city||!s.state||!s.postal_code)throw new Error("Please fill out all required fields before using digital wallet payment");o(!0),h(null);try{const i={customer:n,items:a.map(c=>({variant_id:c.variantId,quantity:c.quantity,unit_price:c.unitPrice,total_price:c.unitPrice*c.quantity,customization:c.customization})),shipping_address:s,billing_address:s,subtotal:r(),tax:0,shipping:0,total:r()},{order:p,client_secret:C}=await N.create(i),{error:f,paymentIntent:b}=await u.confirmCardPayment(C,{payment_method:t});if(f)throw new Error(f.message);b&&b.status==="succeeded"&&(await N.capturePayment(p.id,b.id),w(p.order_number,r(),a),v(),m(`/orders/${p.order_number}`))}catch(i){throw console.error("Checkout error:",i),h(i.message||"Payment failed. Please try again."),i}finally{o(!1)}},S=async t=>{if(t.preventDefault(),!(!u||!x)){o(!0),h(null);try{const i={customer:n,items:a.map(j=>({variant_id:j.variantId,quantity:j.quantity,unit_price:j.unitPrice,total_price:j.unitPrice*j.quantity,customization:j.customization})),shipping_address:s,billing_address:s,subtotal:r(),tax:0,shipping:0,total:r()},{order:p,client_secret:C}=await N.create(i),f=x.getElement(q);if(!f)throw new Error("Card element not found");const{error:b,paymentIntent:c}=await u.confirmCardPayment(C,{payment_method:{card:f,billing_details:{name:n.name,email:n.email}}});if(b)throw new Error(b.message);c&&c.status==="succeeded"&&(await N.capturePayment(p.id,c.id),w(p.order_number,r(),a),v(),m(`/orders/${p.order_number}`))}catch(i){console.error("Checkout error:",i),h(i.message||"Payment failed. Please try again.")}finally{o(!1)}}};return a.length===0?e.jsxs("div",{className:"text-center py-16",children:[e.jsx("p",{className:"text-gray-600 text-lg mb-4",children:"Your cart is empty"}),e.jsx("button",{onClick:()=>m("/products"),className:"btn-primary",children:"Continue Shopping"})]}):e.jsxs("form",{onSubmit:S,className:"grid lg:grid-cols-3 gap-8",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsxs("div",{className:"card",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Customer Information"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block font-semibold mb-1",children:"Email"}),e.jsx("input",{type:"email",required:!0,value:n.email,onChange:t=>P({...n,email:t.target.value}),className:"input"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block font-semibold mb-1",children:"Full Name"}),e.jsx("input",{type:"text",required:!0,value:n.name,onChange:t=>P({...n,name:t.target.value}),className:"input"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block font-semibold mb-1",children:"Phone"}),e.jsx("input",{type:"tel",value:n.phone,onChange:t=>P({...n,phone:t.target.value}),className:"input"})]})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Shipping Address"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block font-semibold mb-1",children:"Address Line 1"}),e.jsx("input",{type:"text",required:!0,value:s.line1,onChange:t=>y({...s,line1:t.target.value}),className:"input"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block font-semibold mb-1",children:"Address Line 2"}),e.jsx("input",{type:"text",value:s.line2,onChange:t=>y({...s,line2:t.target.value}),className:"input"})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block font-semibold mb-1",children:"City"}),e.jsx("input",{type:"text",required:!0,value:s.city,onChange:t=>y({...s,city:t.target.value}),className:"input"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block font-semibold mb-1",children:"State"}),e.jsx("input",{type:"text",required:!0,value:s.state,onChange:t=>y({...s,state:t.target.value}),className:"input"})]})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block font-semibold mb-1",children:"ZIP Code"}),e.jsx("input",{type:"text",required:!0,value:s.postal_code,onChange:t=>y({...s,postal_code:t.target.value}),className:"input"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block font-semibold mb-1",children:"Country"}),e.jsxs("select",{value:s.country,onChange:t=>y({...s,country:t.target.value}),className:"input",children:[e.jsx("option",{value:"US",children:"United States"}),e.jsx("option",{value:"CA",children:"Canada"})]})]})]})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Payment Information"}),e.jsx(M,{totalAmount:r(),onPaymentSuccess:k,disabled:g}),e.jsx("div",{className:"p-4 border border-gray-300 rounded-lg",children:e.jsx(q,{options:{style:{base:{fontSize:"16px",color:"#424770","::placeholder":{color:"#aab7c4"}},invalid:{color:"#9e2146"}}}})})]}),l&&e.jsx("div",{className:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg",children:l})]}),e.jsx("div",{className:"lg:col-span-1",children:e.jsxs("div",{className:"card sticky top-24",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Order Summary"}),e.jsx("div",{className:"space-y-3 mb-6",children:a.map(t=>e.jsxs("div",{className:"flex gap-3 pb-3 border-b",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-semibold",children:t.productTitle}),e.jsxs("p",{className:"text-sm text-gray-600",children:[t.variantColor," / ",t.variantSize]}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Qty: ",t.quantity]})]}),e.jsx("div",{className:"text-right",children:e.jsxs("p",{className:"font-semibold",children:["$",(t.unitPrice*t.quantity).toFixed(2)]})})]},t.id))}),e.jsxs("div",{className:"space-y-2 mb-6",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Subtotal"}),e.jsxs("span",{children:["$",r().toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between text-gray-600",children:[e.jsx("span",{children:"Shipping"}),e.jsx("span",{children:"FREE"})]}),e.jsxs("div",{className:"flex justify-between text-gray-600",children:[e.jsx("span",{children:"Tax"}),e.jsx("span",{children:"$0.00"})]}),e.jsxs("div",{className:"border-t pt-2 flex justify-between font-bold text-lg",children:[e.jsx("span",{children:"Total"}),e.jsxs("span",{className:"text-primary-600",children:["$",r().toFixed(2)]})]})]}),e.jsx("button",{type:"submit",disabled:!u||g,className:"btn-primary w-full",children:g?"Processing...":`Pay $${r().toFixed(2)}`}),e.jsx("p",{className:"text-xs text-gray-500 mt-4 text-center",children:"Your payment information is secure and encrypted."})]})})]})}function G(){return e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12",children:[e.jsx("h1",{className:"text-4xl font-bold mb-8",children:"Checkout"}),e.jsx(F,{stripe:T,children:e.jsx(B,{})})]})}export{G as default};
