import{c as $,j as e,X as W,S as J}from"./index-Dh-0Cy2I.js";import{r,R as Q}from"./react-vendor-Byl6S4M9.js";import{K as L,S as Z,L as ee,I as K,T as te}from"./canvas-vendor-C8lZMoyO.js";/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oe=$("ArrowDownToLine",[["path",{d:"M12 17V3",key:"1cwfxf"}],["path",{d:"m6 11 6 6 6-6",key:"12ii2o"}],["path",{d:"M19 21H5",key:"150jfl"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const B=$("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ie=$("Save",[["path",{d:"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z",key:"1owoqh"}],["polyline",{points:"17 21 17 13 7 13 7 21",key:"1md35c"}],["polyline",{points:"7 3 7 8 15 8",key:"8nz8an"}]]),F={front:"/assets/hoodie-black-front.png",back:"/assets/hoodie-black-back.png",neck:"/assets/hoodie-black-back.png"},G=600,M=700,V=1.15,se=r.forwardRef(({artworks:u=[],onArtworkPositionChange:x,onArtworkDelete:p,view:i="front"},T)=>{const[d,k]=r.useState(null),[g,I]=r.useState([]),[m,l]=r.useState(null),y=r.useRef([]),b=r.useRef(null),f=r.useRef(null),R=r.useRef({front:null,back:null,neck:null}),j=r.useRef(new Map),[X,P]=r.useState({width:690,height:805});r.useImperativeHandle(T,()=>({downloadImage:async()=>{if(!f.current)return;l(null);const s=f.current,t=s.width(),n=s.height(),a=new L.Layer,h=new window.Image;h.crossOrigin="anonymous",await new Promise(C=>{h.onload=()=>{const o=h.height/h.width*40,S=(t-40)/2,v=n-o-20,Y=new L.Image({image:h,x:S,y:v,width:40,height:o,opacity:1});a.add(Y);const H=new L.Text({x:0,y:v+o+3,width:t,text:"stolentee.com",fontSize:8,fontFamily:"Arial, sans-serif",fill:"#000000",align:"center",opacity:1});a.add(H),C()},h.src="/assets/stolentee-logo.png"}),s.add(a),a.moveToTop();const N=s.toDataURL({pixelRatio:3,mimeType:"image/png",quality:1});a.destroy();const c=document.createElement("a");c.download="hoodie-design.png",c.href=N,document.body.appendChild(c),c.click(),document.body.removeChild(c)},captureImage:()=>f.current?(l(null),f.current.toDataURL({pixelRatio:2,mimeType:"image/png",quality:.9})):null,getThumbnailBlob:async()=>{if(!f.current)return null;const s=f.current.toDataURL({pixelRatio:1,mimeType:"image/png",quality:.8});return await(await fetch(s)).blob()},deselect:()=>{l(null)}}));const O=s=>new Promise(t=>{const n=new window.Image;n.src=s,n.crossOrigin="anonymous",n.onload=()=>t(n),n.onerror=()=>t(n)}),U=s=>{const t=s.width/s.height;let n=G,a=G/t;return a>M&&(a=M,n=M*t),n*=V,a*=V,{width:n,height:a}};r.useEffect(()=>{Promise.all([O(F.front),O(F.back),O(F.neck)]).then(([s,t,n])=>{R.current={front:s,back:t,neck:n};const a=i==="neck"?n:i==="back"?t:s;P(U(a)),k(a)})},[]),r.useEffect(()=>{const s=R.current,t=i==="neck"?s.neck:i==="back"?s.back:s.front;t&&(P(U(t)),k(t))},[i]),r.useEffect(()=>{const s=t=>{if((t.key==="Delete"||t.key==="Backspace")&&m&&p){const n=parseInt(m.split("-")[1]);isNaN(n)||(p(n),l(null))}};return window.addEventListener("keydown",s),()=>window.removeEventListener("keydown",s)},[m,p]),r.useEffect(()=>{if(u.length===0){I([]),l(null),y.current=[];return}(async()=>{const t=u.map(n=>{const a=j.current.get(n.url);return a?Promise.resolve(a):new Promise((h,N)=>{const c=new window.Image;c.src=n.url,c.crossOrigin="anonymous",c.onload=()=>{j.current.set(n.url,c),h(c)},c.onerror=N})});try{const n=await Promise.all(t);I(n),y.current=new Array(n.length).fill(null);const a=u[u.length-1];a&&!a.position&&l(`artwork-${u.length-1}`)}catch(n){console.error("Failed to load artworks:",n)}})()},[u]),r.useEffect(()=>{if(m&&b.current){const s=parseInt(m.split("-")[1]),t=y.current[s];t&&(b.current.nodes([t]),b.current.getLayer()?.batchDraw())}},[m]);const _=s=>{const t=y.current[s];t&&x&&x({x:t.x(),y:t.y(),scaleX:t.scaleX(),scaleY:t.scaleY(),rotation:t.rotation()},s)},q=s=>{const t=s.target===s.target.getStage(),n=s.target instanceof L.Image&&s.target.image()===d;(t||n)&&l(null)};return e.jsx("div",{className:"relative w-full h-full flex items-center justify-center overflow-hidden",children:e.jsxs("div",{className:"relative flex items-center justify-center",style:{transform:typeof window<"u"&&window.innerWidth<640?`scale(${Math.min(window.innerWidth/600,1)})`:"scale(1)",transformOrigin:"center center"},children:[g.length>0&&m&&e.jsx("div",{className:"absolute top-3 left-1/2 -translate-x-1/2 bg-black/80 text-white text-xs px-4 py-2 rounded-full z-10",children:"Drag to move â€¢ Corners to resize â€¢ Rotate to spin â€¢ Click away to finish"}),g.length>0&&!m&&e.jsx("div",{className:"absolute top-3 left-1/2 -translate-x-1/2 bg-gray-800/60 text-white text-xs px-4 py-2 rounded-full z-10",children:"Click artwork to edit position and size"}),e.jsx(Z,{ref:f,width:X.width,height:X.height,onMouseDown:q,onTouchStart:q,children:e.jsxs(ee,{children:[d&&e.jsx(K,{image:d,x:0,y:i==="back"?-20:0,width:X.width,height:X.height,onClick:()=>l(null),onTap:()=>l(null)}),g.map((s,t)=>{const n=u[t];if(!n)return null;const a=250,h=250,N=s.width/s.height;let c=a,C=a/N;return C>h&&(C=h,c=h*N),e.jsxs(Q.Fragment,{children:[e.jsx(K,{ref:w=>{y.current[t]=w},image:s,x:n.position?.x??270+t*20,y:n.position?.y??250+t*20,width:c,height:C,scaleX:n.position?.scaleX??1,scaleY:n.position?.scaleY??1,rotation:n.position?.rotation??0,draggable:!0,dragBoundFunc:w=>{const o=i==="back"?{minX:120,maxX:510,minY:100,maxY:650}:{minX:150,maxX:540,minY:100,maxY:650},S=y.current[t];if(!S)return w;const v=S.getClientRect(),Y=v.width,H=v.height;let D=w.x,E=w.y;const z=v.x-S.x(),A=v.y-S.y();return D+z<o.minX&&(D=o.minX-z),D+z+Y>o.maxX&&(D=o.maxX-Y-z),E+A<o.minY&&(E=o.minY-A),E+A+H>o.maxY&&(E=o.maxY-H-A),{x:D,y:E}},onClick:()=>l(`artwork-${t}`),onTap:()=>l(`artwork-${t}`),onDragEnd:()=>_(t),onTransformEnd:()=>_(t)}),m===`artwork-${t}`&&e.jsx(te,{ref:b,keepRatio:!0,boundBoxFunc:(w,o)=>o.width<50||o.height<50||o.width>400||o.height>400?w:o,enabledAnchors:["top-left","top-right","bottom-left","bottom-right"],rotateEnabled:!0,borderStroke:"#000000",borderStrokeWidth:2,anchorSize:12,anchorStroke:"#000000",anchorFill:"#ffffff",anchorCornerRadius:6})]},`artwork-${t}`)})]})})]})})});se.displayName="HoodieCanvas";function le({isOpen:u,onClose:x,onSave:p,isUpdating:i=!1,currentName:T=""}){const[d,k]=r.useState(T),[g,I]=r.useState(!1),[m,l]=r.useState(!1),[y,b]=r.useState(""),f=async()=>{if(!d.trim()){b("Please enter a name for your design");return}I(!0),b("");try{await p(d.trim()),l(!0),setTimeout(()=>{x(),l(!1),k("")},1500)}catch(j){b(j.message||"Failed to save design"),I(!1)}},R=()=>{g||(x(),k(""),b(""),l(!1))};return u?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full mx-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[e.jsx("h2",{className:"text-2xl font-bold",children:i?"Update Design":"Save Design"}),!g&&e.jsx("button",{onClick:R,className:"text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx(W,{size:24})})]}),e.jsx("div",{className:"p-6",children:m?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-green-100 rounded-full mb-4",children:e.jsx(B,{size:32,className:"text-green-600"})}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:i?"Design Updated!":"Design Saved!"}),e.jsxs("p",{className:"text-gray-600",children:['Your design "',d,'" has been saved to your dashboard']})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{htmlFor:"design-name",className:"block text-sm font-medium text-gray-700 mb-2",children:"Design Name"}),e.jsx("input",{id:"design-name",type:"text",value:d,onChange:j=>k(j.target.value),onKeyPress:j=>j.key==="Enter"&&f(),placeholder:"e.g., Summer Collection Tee",className:"w-full px-4 py-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-black focus:border-transparent",disabled:g,autoFocus:!0}),y&&e.jsx("p",{className:"mt-2 text-sm text-red-600",children:y})]}),e.jsx("div",{className:"bg-gray-50 rounded-lg p-4 mb-6",children:e.jsxs("p",{className:"text-sm text-gray-600",children:["ðŸ’¡ ",e.jsx("strong",{children:"Tip:"})," Give your design a memorable name so you can easily find it later!"]})})]})}),!m&&e.jsxs("div",{className:"flex gap-3 p-6 border-t border-gray-200",children:[e.jsx("button",{onClick:R,disabled:g,className:"flex-1 px-4 py-3 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:"Cancel"}),e.jsx("button",{onClick:f,disabled:g||!d.trim(),className:"flex-1 px-4 py-3 bg-black text-white rounded-md hover:bg-gray-800 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:g?e.jsxs("span",{className:"flex items-center justify-center gap-2",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),"Saving..."]}):i?"Update Design":"Save Design"})]})]})}):null}function ce({message:u,type:x="success",onClose:p,duration:i=3e3}){r.useEffect(()=>{const k=setTimeout(()=>{p()},i);return()=>clearTimeout(k)},[p,i]);const T={success:e.jsx(B,{size:20}),error:e.jsx(W,{size:20}),info:e.jsx(J,{size:20})},d={success:"bg-green-500",error:"bg-red-500",info:"bg-blue-500"};return e.jsxs("div",{className:"fixed bottom-8 right-8 z-50 animate-slideUp",role:"alert",children:[e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl overflow-hidden max-w-md",children:[e.jsxs("div",{className:"flex items-center gap-4 p-4",children:[e.jsx("div",{className:`${d[x]} text-white p-2 rounded-xl flex-shrink-0`,children:T[x]}),e.jsx("p",{className:"text-gray-900 font-medium flex-1",children:u}),e.jsx("button",{onClick:p,className:"text-gray-400 hover:text-gray-600 transition-colors p-1","aria-label":"Close",children:e.jsx(W,{size:18})})]}),e.jsx("div",{className:"h-1 bg-gray-100",children:e.jsx("div",{className:`h-full ${d[x]} transition-all`,style:{animation:`shrink ${i}ms linear`,transformOrigin:"left"}})})]}),e.jsx("style",{children:`
        @keyframes slideUp {
          from {
            transform: translateY(100px);
            opacity: 0;
          }
          to {
            transform: translateY(0);
            opacity: 1;
          }
        }

        @keyframes shrink {
          from {
            width: 100%;
          }
          to {
            width: 0%;
          }
        }
      `})]})}export{oe as A,se as H,ie as S,ce as T,le as a};
