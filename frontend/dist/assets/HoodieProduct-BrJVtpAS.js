import{u as ie,a as ce,j as e,e as I,d as B}from"./index-Dh-0Cy2I.js";import{e as de,r as n,f as me,L as xe}from"./react-vendor-Byl6S4M9.js";import{A as ue,S as he,H as ge,a as fe,T as pe}from"./Toast-DtyGLfYK.js";import{U as G}from"./upload-DYkv1GN-.js";import"./auth-vendor-Cg5HAGal.js";import"./canvas-vendor-C8lZMoyO.js";const be="9f9e4e98-4128-4d09-af21-58e5523eed14",W="Black",je=["S","M","L","XL","2XL"],K=35.99,ke=5,we=1,A=4,Q={S:"242180eb-3029-40bc-b185-7ae8e3328b31",M:"677f0bf4-98b9-4088-9151-7422312bbf76",L:"d6495a9b-0e81-40f7-81e4-3cf09eb25f2a",XL:"be75094a-c54b-4e3e-b861-b57aaaf2c774","2XL":"0e302d1c-ce97-4a69-96df-eb603fca599e"};function _e(){const M=de(),q=ie(t=>t.addItem),f=n.useRef(null),{isAuthenticated:_}=ce(),[z]=me(),[b,H]=n.useState(null),[Z,D]=n.useState(!1),[P,U]=n.useState(""),[Y,v]=n.useState(!1),[ee,V]=n.useState(""),[h,X]=n.useState("M"),[y,te]=n.useState(1),[o,g]=n.useState("front"),[d,j]=n.useState([]),[m,k]=n.useState([]),[i,w]=n.useState(null),[L,se]=n.useState(!0),[F,N]=n.useState(!1),[O,S]=n.useState(!1),[E,C]=n.useState(!1),re=()=>o==="front"?d:o==="neck"?i?[i]:[]:o==="back"?m:[],R=(()=>{let t=K;return[d.length>0,m.length>0].filter(Boolean).length===2&&(t+=ke),i!==null&&(t+=we),t})(),$=async t=>{const s=t.target.files?.[0];if(!s)return;t.target.value="";const u={url:URL.createObjectURL(s),position:null,assetId:void 0};if(o==="front"){if(d.length>=A){alert(`Maximum ${A} artworks allowed on front view`);return}const r=d.length;j([...d,u]),I.uploadFile(s).then(l=>{j(c=>{const x=[...c];return x[r]&&(x[r]={...x[r],url:`http://localhost:3001${l.file_url}`,assetId:l.id}),x})}).catch(l=>console.error("Upload failed:",l))}else if(o==="neck"){if(i){alert("Only 1 artwork allowed on neck view");return}w(u),I.uploadFile(s).then(r=>{w(l=>l?{...l,url:`http://localhost:3001${r.file_url}`,assetId:r.id}:null)}).catch(r=>console.error("Upload failed:",r))}else if(o==="back"){if(m.length>=A){alert(`Maximum ${A} artworks allowed on back view`);return}const r=m.length;k([...m,u]),I.uploadFile(s).then(l=>{k(c=>{const x=[...c];return x[r]&&(x[r]={...x[r],url:`http://localhost:3001${l.file_url}`,assetId:l.id}),x})}).catch(l=>console.error("Upload failed:",l))}},ae=()=>{if(!h){alert("Please select a size");return}let t;try{f.current?.captureImage&&(t=f.current.captureImage()||void 0)}catch(a){console.error("Error capturing mockup:",a)}const s={id:`hoodie-${h}-${Date.now()}`,variantId:`hoodie-${h}`,productTitle:"Classic Hoodie",variantColor:W,variantSize:h,quantity:y,unitPrice:R,customization:{method:"dtg",frontArtworks:d,backArtworks:m,neckArtwork:i},mockupUrl:t};q(s),M("/cart")},oe=()=>{f.current&&f.current.downloadImage&&f.current.downloadImage()},le=async()=>{if(!_){M("/login",{state:{from:window.location.pathname+window.location.search}});return}if(b&&P){try{await J(P),V("Design updated successfully!"),v(!0),setTimeout(()=>v(!1),3e3)}catch(t){console.error("Error updating design:",t),alert("Failed to update design")}return}D(!0)},J=async t=>{try{const s={front:d.map(r=>r.position),back:m.map(r=>r.position),neck:i?[i.position]:[],selectedColor:W,selectedSize:h},a=[...d.filter(r=>r.assetId).map(r=>r.assetId),...m.filter(r=>r.assetId).map(r=>r.assetId),...i?.assetId?[i.assetId]:[]];let u="";if(f.current?.getThumbnailBlob)try{const r=await f.current.getThumbnailBlob();if(r){const l=new File([r],"thumbnail.png",{type:"image/png"});u=(await I.uploadFile(l)).file_url}}catch(r){console.error("Failed to capture thumbnail:",r)}if(b)await B.update(b,{name:t,variantId:Q[h],designData:s,artworkIds:a,thumbnailUrl:u}),U(t);else{const r=await B.save({name:t,productId:be,variantId:Q[h],designData:s,artworkIds:a,thumbnailUrl:u});H(r.id),U(t)}D(!1),V(b?"Design updated successfully!":"Design saved successfully!"),v(!0),setTimeout(()=>v(!1),3e3)}catch(s){throw console.error("Error saving design:",s),s}};n.useEffect(()=>{o==="neck"?(C(!0),N(!1),S(!1)):o==="front"?(N(!0),S(!1),C(!1)):o==="back"&&(S(!0),N(!1),C(!1))},[o]);const ne=async t=>{try{const s=await B.getById(t);H(s.id),U(s.name);const a=s.artwork_ids||[],u=s.artwork_urls||{},r=c=>!c||c.startsWith("http")?c:`http://localhost:3000${c}`;let l=0;if(s.design_data){if(s.design_data.front?.length>0){const c=s.design_data.front.map(x=>{const p=a[l],T=p?r(u[p]):"";return l++,{url:T,position:x,assetId:p}});j(c)}if(s.design_data.back?.length>0){const c=s.design_data.back.map(x=>{const p=a[l],T=p?r(u[p]):"";return l++,{url:T,position:x,assetId:p}});k(c)}if(s.design_data.neck?.length>0){const c=a[l],x=c?r(u[c]):"";w({url:x,position:s.design_data.neck[0],assetId:c})}s.design_data.selectedSize&&X(s.design_data.selectedSize)}}catch(s){console.error("Error loading design:",s)}};return n.useEffect(()=>{const t=z.get("designId");t&&_&&ne(t)},[z,_]),e.jsxs("div",{className:"min-h-screen bg-white",children:[e.jsx("div",{className:"border-b border-gray-200 bg-white",children:e.jsxs("div",{className:"relative px-6 py-1.5 flex items-center",children:[e.jsx("h1",{className:"text-sm font-bold",children:"Classic Hoodie"}),e.jsx(xe,{to:"/",className:"absolute left-1/2 -translate-x-1/2 text-lg font-bold hover:text-gray-600 transition-colors",children:"StolenTee"}),e.jsxs("div",{className:"ml-auto flex items-center gap-4",children:[e.jsx("button",{onClick:oe,disabled:d.length===0&&m.length===0&&!i,title:"Download Design",className:`p-2 rounded-md transition-colors ${d.length>0||m.length>0||i?"hover:bg-gray-100":"opacity-30 cursor-not-allowed"}`,children:e.jsx(ue,{size:16})}),e.jsxs("button",{onClick:le,className:"flex items-center gap-1.5 px-4 py-1.5 text-xs font-medium rounded-md transition-colors bg-black text-white hover:bg-gray-800",children:[e.jsx(he,{size:14}),b?"Update Design":"Save Design"]}),e.jsxs("div",{className:"text-sm font-normal",children:["from $",K.toFixed(2)]})]})]})}),e.jsxs("div",{className:"grid lg:grid-cols-[1fr_400px] h-[calc(100vh-40px)]",children:[e.jsxs("div",{className:"bg-white flex flex-col relative h-full overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 flex items-center justify-center pt-2 pb-16 px-6",children:e.jsx(ge,{ref:f,artworks:re(),view:o,onArtworkPositionChange:(t,s)=>{if(o==="front"){const a=[...d];a[s]={...a[s],position:t},j(a)}else if(o==="neck"&&i)w({...i,position:t});else if(o==="back"){const a=[...m];a[s]={...a[s],position:t},k(a)}},onArtworkDelete:t=>{o==="front"?j(d.filter((s,a)=>a!==t)):o==="neck"?w(null):o==="back"&&k(m.filter((s,a)=>a!==t))}})}),e.jsxs("div",{className:"absolute bottom-8 left-1/2 -translate-x-1/2 bg-white rounded-full shadow-lg px-2 py-2 flex gap-1",children:[e.jsx("button",{onClick:()=>g("front"),className:`px-5 py-2 rounded-full text-sm font-medium transition-colors ${o==="front"?"bg-black text-white":"text-gray-700 hover:bg-gray-100"}`,children:"Front"}),e.jsx("button",{onClick:()=>g("back"),className:`px-5 py-2 rounded-full text-sm font-medium transition-colors ${o==="back"?"bg-black text-white":"text-gray-700 hover:bg-gray-100"}`,children:"Back"}),e.jsx("button",{onClick:()=>g("neck"),className:`px-5 py-2 rounded-full text-sm font-medium transition-colors ${o==="neck"?"bg-black text-white":"text-gray-700 hover:bg-gray-100"}`,children:"Neck"})]})]}),e.jsx("div",{className:"bg-white border-l border-gray-200 overflow-y-auto",children:e.jsxs("div",{className:"p-5 space-y-1",children:[e.jsxs("div",{className:"border-t border-gray-200 pt-5 pb-4",children:[e.jsxs("button",{onClick:()=>se(!L),className:"w-full flex items-center justify-between mb-4 group",children:[e.jsx("h3",{className:"text-sm font-semibold",children:"Garment Color"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"w-5 h-5 rounded-full border border-gray-300",style:{backgroundColor:"#000000"}}),e.jsx("span",{className:"text-gray-400 group-hover:text-gray-600",children:L?"−":"+"})]})]}),L&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"text-xs text-gray-400 uppercase tracking-wider mb-3",children:"Pre-developed"}),e.jsx("div",{className:"grid grid-cols-2 gap-2.5",children:e.jsxs("button",{className:"flex items-center gap-2.5 p-2.5 rounded-md border border-gray-900 bg-gray-50 transition-all",children:[e.jsx("div",{className:"w-8 h-8 rounded-full border border-gray-300 flex-shrink-0",style:{backgroundColor:"#000000"}}),e.jsx("span",{className:"text-xs font-medium",children:"Black"})]})})]})]}),e.jsxs("div",{className:"border-t border-gray-200 pt-5 pb-4",children:[e.jsxs("button",{onClick:()=>N(!F),className:"w-full flex items-center justify-between mb-4 group",children:[e.jsx("h3",{className:"text-sm font-semibold",children:"Front Artwork"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"w-5 h-5 rounded-full bg-black text-white text-xs flex items-center justify-center",children:d.length}),e.jsx("span",{className:"text-gray-400 group-hover:text-gray-600",children:F?"−":"+"})]})]}),F&&e.jsxs("div",{className:"space-y-4",children:[d.length<4&&e.jsxs("div",{className:"border-2 border-dashed border-gray-200 rounded-md p-6 text-center hover:border-gray-300 transition-colors cursor-pointer",onClick:()=>g("front"),children:[e.jsx("input",{type:"file",accept:"image/png,image/jpeg,image/svg+xml,application/pdf",onChange:t=>{g("front"),$(t)},className:"hidden",id:"front-artwork-upload",onClick:t=>t.stopPropagation()}),e.jsxs("label",{htmlFor:"front-artwork-upload",className:"cursor-pointer",children:[e.jsx(G,{className:"mx-auto mb-2 text-gray-300",size:28}),e.jsx("p",{className:"text-xs text-gray-600 font-medium",children:"Upload front artwork (up to 4)"}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"PNG, JPG, SVG or PDF"})]})]}),d.map((t,s)=>e.jsx("div",{className:"border border-gray-200 rounded-md p-3 bg-gray-50",children:e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-10 h-10 bg-white border border-gray-200 rounded flex items-center justify-center overflow-hidden",children:e.jsx("img",{src:t.url,alt:"Front Artwork",className:"w-full h-full object-contain"})}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-xs font-medium",children:["Artwork ",s+1]}),e.jsx("p",{className:"text-xs text-gray-500",children:"Click front view to edit"})]})]}),e.jsx("button",{onClick:()=>j(d.filter((a,u)=>u!==s)),className:"text-xs text-red-600 hover:text-red-700",children:"Remove"})]})},s))]})]}),e.jsxs("div",{className:"border-t border-gray-200 pt-5 pb-4",children:[e.jsxs("button",{onClick:()=>S(!O),className:"w-full flex items-center justify-between mb-4 group",children:[e.jsx("h3",{className:"text-sm font-semibold",children:"Back Artwork"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"w-5 h-5 rounded-full bg-black text-white text-xs flex items-center justify-center",children:m.length}),e.jsx("span",{className:"text-gray-400 group-hover:text-gray-600",children:O?"−":"+"})]})]}),O&&e.jsxs("div",{className:"space-y-4",children:[m.length<4&&e.jsxs("div",{className:"border-2 border-dashed border-gray-200 rounded-md p-6 text-center hover:border-gray-300 transition-colors cursor-pointer",onClick:()=>g("back"),children:[e.jsx("input",{type:"file",accept:"image/png,image/jpeg,image/svg+xml,application/pdf",onChange:t=>{g("back"),$(t)},className:"hidden",id:"back-artwork-upload",onClick:t=>t.stopPropagation()}),e.jsxs("label",{htmlFor:"back-artwork-upload",className:"cursor-pointer",children:[e.jsx(G,{className:"mx-auto mb-2 text-gray-300",size:28}),e.jsx("p",{className:"text-xs text-gray-600 font-medium",children:"Upload back artwork (up to 4)"}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"PNG, JPG, SVG or PDF"})]})]}),m.map((t,s)=>e.jsx("div",{className:"border border-gray-200 rounded-md p-3 bg-gray-50",children:e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-10 h-10 bg-white border border-gray-200 rounded flex items-center justify-center overflow-hidden",children:e.jsx("img",{src:t.url,alt:"Back Artwork",className:"w-full h-full object-contain"})}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-xs font-medium",children:["Artwork ",s+1]}),e.jsx("p",{className:"text-xs text-gray-500",children:"Click back view to edit"})]})]}),e.jsx("button",{onClick:()=>k(m.filter((a,u)=>u!==s)),className:"text-xs text-red-600 hover:text-red-700",children:"Remove"})]})},s))]})]}),e.jsxs("div",{className:"border-t border-gray-200 pt-5 pb-4",children:[e.jsxs("button",{onClick:()=>C(!E),className:"w-full flex items-center justify-between mb-4 group",children:[e.jsx("h3",{className:"text-sm font-semibold",children:"Neck Label"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"w-5 h-5 rounded-full bg-black text-white text-xs flex items-center justify-center",children:i?"1":"0"}),e.jsx("span",{className:"text-gray-400 group-hover:text-gray-600",children:E?"−":"+"})]})]}),E&&e.jsxs("div",{className:"space-y-4",children:[!i&&e.jsxs("div",{className:"border-2 border-dashed border-gray-200 rounded-md p-6 text-center hover:border-gray-300 transition-colors cursor-pointer",onClick:()=>g("neck"),children:[e.jsx("input",{type:"file",accept:"image/png,image/jpeg,image/svg+xml,application/pdf",onChange:t=>{g("neck"),$(t)},className:"hidden",id:"neck-label-upload",onClick:t=>t.stopPropagation()}),e.jsxs("label",{htmlFor:"neck-label-upload",className:"cursor-pointer",children:[e.jsx(G,{className:"mx-auto mb-2 text-gray-300",size:28}),e.jsx("p",{className:"text-xs text-gray-600 font-medium",children:"Upload neck label"}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"PNG, JPG, SVG or PDF"})]})]}),i&&e.jsx("div",{className:"border border-gray-200 rounded-md p-3 bg-gray-50",children:e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-10 h-10 bg-white border border-gray-200 rounded flex items-center justify-center overflow-hidden",children:e.jsx("img",{src:i.url,alt:"Neck Label",className:"w-full h-full object-contain"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium",children:"Neck Label"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Click neck view to edit"})]})]}),e.jsx("button",{onClick:()=>w(null),className:"text-xs text-red-600 hover:text-red-700",children:"Remove"})]})})]})]}),e.jsxs("div",{className:"border-t border-gray-200 pt-5 pb-4",children:[e.jsx("label",{className:"block text-xs font-medium mb-3",children:"Size"}),e.jsx("div",{className:"grid grid-cols-3 gap-2",children:je.map(t=>e.jsx("button",{onClick:()=>X(t),className:`px-3 py-2 border rounded-md text-xs font-medium transition-all ${h===t?"border-black bg-black text-white":"border-gray-300 hover:border-gray-400"}`,children:t},t))})]}),e.jsx("div",{className:"border-t border-gray-200 pt-5 pb-4",children:e.jsxs("div",{className:`grid ${y>=2?"grid-cols-3":"grid-cols-2"} gap-3`,children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-500 mb-2",children:"Quantity"}),e.jsx("input",{type:"number",min:"1",value:y,onChange:t=>te(parseInt(t.target.value)||1),className:"w-full px-2 py-1.5 text-sm border border-gray-300 rounded-md focus:outline-none focus:border-gray-900"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-500 mb-2",children:"Unit cost"}),e.jsxs("div",{className:"text-sm font-semibold",children:["$",R.toFixed(2)]})]}),y>=2&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-500 mb-2",children:"Total cost"}),e.jsxs("div",{className:"text-sm font-semibold",children:["$",(R*y).toFixed(2)]})]})]})}),e.jsx("div",{className:"pt-4",children:e.jsx("button",{onClick:ae,disabled:!h,className:"w-full py-3 bg-black text-white text-sm font-medium rounded-full hover:bg-gray-800 disabled:bg-gray-400 disabled:cursor-not-allowed transition-colors",children:"Add to Cart"})})]})})]}),e.jsx(fe,{isOpen:Z,onClose:()=>D(!1),onSave:J,isUpdating:!!b,currentName:P}),Y&&e.jsx(pe,{message:ee,onClose:()=>v(!1)})]})}export{_e as default};
